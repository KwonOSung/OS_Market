<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인 페이지</title>
    <link rel="stylesheet" th:href="@{/css/MainPage.css}">

</head>
<body>

<header>
    <div class="logo">
        <a href="/"><img th:src="@{/images/logo.png}" alt="로고"></a>
    </div>

    <div class="search-bar">
        <form th:action="@{/product/filter}" method="get" id="searchForm">
            <input type="text" name="keyword" placeholder="상품을 검색하세요" id="searchInput">
            <button type="submit" id="searchBtn">검색</button>
        </form>
    </div>

    <div class="user-menu">
        <div th:if="${#authorization.expression('isAuthenticated()')}">
            <span th:text="${#authentication.name}">유저</span>님 환영합니다!
            <a href="/mypage"><button>마이페이지</button></a>
            <a href="/cart"><button>장바구니</button></a>

            <!-- ✅ 관리자 전용 버튼 -->
            <div th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
                <a href="/admin"><button>관리자 페이지</button></a>
            </div>

            <a href="/logout"><button>로그아웃</button></a>
        </div>

        <div th:if="${#authorization.expression('!isAuthenticated()')}">
            <a href="/login"><button>로그인</button></a>
            <a href="/insertMember"><button>회원가입</button></a>
        </div>
    </div>
</header>

<nav>
    <a href="/">전체 상품</a>
    <a href="/">베스트</a> <!--product/best-->
    <a href="/product/filter?type=도서">도서</a>
    <a href="/product/filter?type=전자기기">전자기기</a>
    <a href="/free">자유게시판</a>
    <a href="/">상품 리뷰 게시판</a>
</nav>

<main>
    <!-- 상품 리스트 (예시) -->
    <div th:if="${keyword != null}">
        <h2 th:text="'검색 결과: ' + ${keyword}"></h2>
    </div>
    <div th:if="${keyword == null}">
        <h2>전체 상품</h2>
    </div>

    <!-- 상품 리스트 -->
    <div class="product-list">

        <!-- 검색 결과 없을 때 메시지 -->
        <div th:if="${#lists.isEmpty(products)}">
            <p>검색 결과가 없습니다.</p>
        </div>

        <!-- 검색 결과 있을 때 -->
        <div class="product-card" th:each="p : ${products}">
            <img th:src="${p.imageUrl}" alt="상품 이미지">
            <h3 th:text="${p.productName}"></h3>
            <p th:text="${p.price + '원'}"></p>
            <a th:href="@{'/product/' + ${p.id}}">상세보기</a>
        </div>
    </div>


</main>

<script>
    // DOM이 로드된 후 실행
    document.addEventListener('DOMContentLoaded', function() {

        // 헤더 스크롤 효과
        function handleScroll() {
            const header = document.querySelector('header');
            if (window.scrollY > 50) {
                header.style.background = 'rgba(255, 255, 255, 0.98)';
                header.style.boxShadow = '0 2px 30px rgba(0, 0, 0, 0.15)';
            } else {
                header.style.background = 'rgba(255, 255, 255, 0.95)';
                header.style.boxShadow = '0 2px 20px rgba(0, 0, 0, 0.1)';
            }
        }

        window.addEventListener('scroll', handleScroll);

        // 검색 폼 제출 시 로딩 효과
        const searchForm = document.getElementById('searchForm');
        const searchBtn = document.getElementById('searchBtn');

        if (searchForm && searchBtn) {
            searchForm.addEventListener('submit', function() {
                searchBtn.classList.add('search-loading');
                searchBtn.innerHTML = '검색중...';
                searchBtn.disabled = true;
            });
        }

        // 상품 카드 애니메이션 개선
        const productCards = document.querySelectorAll('.product-card');

        // Intersection Observer for scroll animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }, index * 100);
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });

        // 초기 상태 설정 및 관찰 시작
        productCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(card);
        });

        // 상품 카드 3D 호버 효과
        productCards.forEach(card => {
            card.addEventListener('mouseenter', function(e) {
                this.style.transform = 'translateY(-10px) rotateX(5deg) rotateY(5deg)';
            });

            card.addEventListener('mouseleave', function(e) {
                this.style.transform = 'translateY(0) rotateX(0) rotateY(0)';
            });

            // 마우스 움직임에 따른 미묘한 기울임 효과
            card.addEventListener('mousemove', function(e) {
                const rect = this.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const deltaX = (e.clientX - centerX) / rect.width * 10;
                const deltaY = (e.clientY - centerY) / rect.height * 10;

                this.style.transform = `translateY(-10px) rotateX(${-deltaY}deg) rotateY(${deltaX}deg)`;
            });
        });

        // 네비게이션 활성 상태 표시
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('nav a');

        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                link.style.color = 'white';
            }
        });

        // 검색 입력 필드 포커스 효과
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('focus', function() {
                this.parentElement.style.transform = 'translateY(-2px)';
                this.parentElement.style.boxShadow = '0 6px 25px rgba(0, 0, 0, 0.15)';
            });

            searchInput.addEventListener('blur', function() {
                this.parentElement.style.transform = 'translateY(0)';
                this.parentElement.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.1)';
            });
        }

        // 페이지 로딩 애니메이션
        document.body.style.opacity = '0';
        setTimeout(() => {
            document.body.style.transition = 'opacity 0.5s ease';
            document.body.style.opacity = '1';
        }, 100);

        // 버튼 클릭 효과
        const buttons = document.querySelectorAll('button, .product-card a');
        buttons.forEach(button => {
            button.addEventListener('click', function(e) {
                // 리플 효과
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;

                ripple.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    background: rgba(255, 255, 255, 0.3);
                    border-radius: 50%;
                    transform: scale(0);
                    animation: ripple 0.6s linear;
                    pointer-events: none;
                `;

                this.style.position = 'relative';
                this.style.overflow = 'hidden';
                this.appendChild(ripple);

                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });

        // CSS 애니메이션 정의
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

    });

</script>

</body>
</html>